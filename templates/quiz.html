{% include "header.html" %}
<div class="container mt-5">
    <h1 class="mb-4">{{ quiz.quizTitle }}</h1>
    <p class="mb-4">{{ quiz.quizSynopsis }}</p>

<div class="question-container">
    <h2 class="mb-3">Question <span id="questionNumber">1</span>:</h2>
    <p class="mb-3" id="questionText">{{ quiz.questions[0].question }}</p>
    <form id="quizForm">
        <div id="optionsContainer">
            {% for option in quiz.questions[0].options %}
            <div class="form-check mb-2">
                <input class="form-check-input" type="radio" name="quizQuestion" id="option{{ loop.index }}" value="{{ option }}">
                <label class="form-check-label" for="option{{ loop.index }}">
                    {{ option }}
                </label>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="btn btn-primary mt-3" onclick="submitAnswer()">Submit</button>
    </form>
</div>

<script>
let currentQuestion = 0;
const questions = {{ quiz.questions|tojson }};
const userAnswers = [];

function submitAnswer() {
    const selectedAnswer = document.querySelector('input[name="quizQuestion"]:checked');
    if (selectedAnswer) {
        userAnswers.push(selectedAnswer.value);
        currentQuestion++;
        if (currentQuestion < questions.length) {
            updateQuestion();
        } else {
            showResults();
        }
    } else {
        alert("Please select an answer.");
    }
}

function updateQuestion() {
    document.getElementById('questionNumber').textContent = currentQuestion + 1;
    document.getElementById('questionText').textContent = questions[currentQuestion].question;
    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';
    questions[currentQuestion].options.forEach((option, index) => {
        optionsContainer.innerHTML += `
            <div class="form-check mb-2">
                <input class="form-check-input" type="radio" name="quizQuestion" id="option${index + 1}" value="${option}">
                <label class="form-check-label" for="option${index + 1}">
                    ${option}
                </label>
            </div>
        `;
    });
}

function showResults() {
    const quizContainer = document.querySelector('.question-container');
    let resultsHTML = '<h2 class="mb-3">Quiz Results</h2>';
    
    questions.forEach((question, index) => {
        const userAnswer = userAnswers[index];
        const correctAnswer = question.answer;
        const isCorrect = userAnswer === correctAnswer;
        
        resultsHTML += `
            <div class="mb-4">
                <h4>Question ${index + 1}:</h4>
                <p>${question.question}</p>
                <ul class="list-group">
                    ${question.options.map(option => `
                        <li class="list-group-item ${option === userAnswer ? (isCorrect ? 'list-group-item-success' : 'list-group-item-danger') : ''}
                                                    ${option === correctAnswer && !isCorrect ? 'list-group-item-success' : ''}">
                            ${option}
                            ${option === userAnswer ? ' (Your Answer)' : ''}
                            ${option === correctAnswer ? ' (Correct Answer)' : ''}
                        </li>
                    `).join('')}
                </ul>
            </div>
        `;
    });
    
    quizContainer.innerHTML = resultsHTML;
}
</script>